# Компактное API для бота PolzaAI

## Описание

Создано сокращенное API `/api/people/compact` специально для бота PolzaAI, которое возвращает только необходимые поля для работы бота, что значительно уменьшает размер ответа и ускоряет обработку.

## Эндпоинт

```
GET /api/people/compact
```

## Параметры запроса

- `search` (string, optional) - Поиск по ФИО, должности, телефону, СНИЛС, ИНН, адресу, статусу
- `position` (string, optional) - Фильтр по должности
- `phone` (string, optional) - Фильтр по телефону
- `status` (string, optional) - Фильтр по статусу

## Формат ответа

Возвращает массив объектов людей с сокращенным набором полей:

```json
[
  {
    "id": 1,
    "full_name": "Иванов Иван Иванович",
    "phone": "+7 (999) 123-45-67",
    "snils": "123-456-789 00",
    "inn": "123456789012",
    "position": "Инженер",
    "birth_date": "1985-01-15",
    "address": "г. Москва, ул. Примерная, д. 1",
    "photo": "photo_filename.jpg",
    "all_certificates": [
      {
        "id": 1,
        "name": "ВИТР (ОТ)",
        "description": "Вводный инструктаж по технике безопасности",
        "assigned_data": {
          "assigned_date": "2024-01-15",
          "status": 4
        }
      },
      {
        "id": 2,
        "name": "Первая помощь",
        "description": "Обучение оказанию первой помощи",
        "assigned_data": null
      }
    ]
  }
]
```

## Поля ответа

### Основная информация о человеке
- `id` - Уникальный идентификатор
- `full_name` - Полное имя
- `phone` - Номер телефона
- `snils` - СНИЛС
- `inn` - ИНН
- `position` - Должность
- `birth_date` - Дата рождения
- `address` - Адрес
- `photo` - Имя файла фотографии

### Информация о сертификатах
- `all_certificates` - Массив всех сертификатов с их статусом

#### Поля сертификата
- `id` - ID сертификата
- `name` - Название сертификата
- `description` - Описание сертификата
- `assigned_data` - Данные о выдаче (null если не выдан)

#### Поля assigned_data (если сертификат выдан)
- `assigned_date` - Дата выдачи
- `status` - Статус сертификата:
  - 1 - Отсутствует
  - 2 - Просрочен
  - 3 - Скоро просрочится
  - 4 - Действует

**Убраны неиспользуемые поля:**
- `expiry_date` - Срок действия (в годах)
- `created_at` - Дата создания
- `updated_at` - Дата обновления
- `certificate_number` - Номер сертификата
- `notes` - Примечания
- `certificate_file` - Файл сертификата

## Преимущества компактного API

1. **Уменьшенный размер ответа** - убраны неиспользуемые поля
2. **Быстрая обработка** - меньше данных для передачи и парсинга
3. **Оптимизация для бота** - только необходимые поля для работы ИИ
4. **Совместимость** - старое API остается без изменений

## Примеры использования

### Получить всех людей
```
GET /api/people/compact
```

### Поиск по ФИО
```
GET /api/people/compact?search=Иванов
```

### Фильтр по должности
```
GET /api/people/compact?position=Инженер
```

### Комбинированный поиск
```
GET /api/people/compact?search=Иванов&position=Инженер
```

## Обработка ошибок

В случае ошибки API возвращает:

```json
{
  "success": false,
  "message": "Описание ошибки",
  "error": "Детали ошибки"
}
```

## Статус коды

- `200` - Успешный запрос
- `500` - Внутренняя ошибка сервера

## Интеграция с ботом

Бот PolzaAI автоматически использует новое компактное API вместо полного, что приводит к:
- Уменьшению времени ответа
- Снижению нагрузки на сеть
- Более быстрой обработке данных ИИ
- Устранению ошибок превышения лимита токенов
