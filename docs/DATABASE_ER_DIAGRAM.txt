╔══════════════════════════════════════════════════════════════════════════════╗
║                    ER-ДИАГРАММА БАЗЫ ДАННЫХ                                  ║
║                    WebAPILaborService                                        ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────┐
│     USERS       │
├─────────────────┤
│ id (PK)         │
│ name            │
│ email (UK)      │
│ password        │
│ remember_token  │
│ timestamps      │
└────────┬────────┘
         │
         │ 1:N
         │
         ▼
┌─────────────────┐
│   SESSIONS      │
├─────────────────┤
│ id (PK)         │
│ user_id (FK)    │
│ ip_address      │
│ user_agent      │
│ payload         │
│ last_activity   │
└─────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                         PEOPLE                                   │
├─────────────────────────────────────────────────────────────────┤
│ id (PK)                                                          │
│ full_name                                                        │
│ phone, snils, inn, position                                      │
│ birth_date, address, status                                       │
│ passport_page_1 (+ metadata)                                     │
│ passport_page_5 (+ metadata)                                     │
│ photo (+ metadata)                                               │
│ certificates_file (+ metadata)                                   │
│ timestamps                                                       │
└──────────────┬──────────────────────────────────────────────────┘
               │
               │ N:M (через people_certificates)
               │
               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PEOPLE_CERTIFICATES                          │
│                    (Pivot Table)                                │
├─────────────────────────────────────────────────────────────────┤
│ id (PK)                                                          │
│ people_id (FK) ───────────┐                                     │
│ certificate_id (FK) ───────┼──────┐                             │
│ assigned_date              │      │                             │
│ certificate_number         │      │                             │
│ status (1-4)               │      │                             │
│ notes                      │      │                             │
│ certificate_file (+ metadata)                                   │
│ timestamps                 │      │                             │
│                            │      │                             │
│ UNIQUE(people_id, certificate_id) │                             │
└────────────────────────────┼──────┼─────────────────────────────┘
                             │      │
                             │      │
                             │      │ N:M
                             │      │
                             │      ▼
                             │  ┌─────────────────────────────────┐
                             │  │      CERTIFICATES               │
                             │  ├─────────────────────────────────┤
                             │  │ id (PK)                         │
                             │  │ name                            │
                             │  │ description                     │
                             │  │ expiry_date (integer, days)     │
                             │  │ timestamps                      │
                             │  └───────────┬─────────────────────┘
                             │              │
                             │              │ 1:1
                             │              │
                             │              ▼
                             │  ┌─────────────────────────────────┐
                             │  │   CERTIFICATE_ORDERS            │
                             │  ├─────────────────────────────────┤
                             │  │ id (PK)                         │
                             │  │ certificate_id (FK, UK)         │
                             │  │ sort_order                      │
                             │  │ timestamps                      │
                             │  └─────────────────────────────────┘
                             │
                             └─────────────────────────────────────┐
                                                                   │
┌─────────────────────────────────────────────────────────────────┐
│                      API_TOKENS                                 │
├─────────────────────────────────────────────────────────────────┤
│ id (PK)                                                          │
│ name                                                             │
│ token (UK, 64 chars)                                            │
│ description                                                      │
│ last_used_at                                                     │
│ expires_at                                                       │
│ is_active                                                        │
│ timestamps                                                       │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│              PASSWORD_RESET_TOKENS                               │
├─────────────────────────────────────────────────────────────────┤
│ email (PK)                                                       │
│ token                                                            │
│ created_at                                                       │
└─────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════
                        ОСНОВНЫЕ СВЯЗИ
═══════════════════════════════════════════════════════════════════

1. USERS ──(1:N)──> SESSIONS
   Один пользователь может иметь несколько активных сессий

2. PEOPLE ──(N:M)──> CERTIFICATES (через PEOPLE_CERTIFICATES)
   - Один сотрудник может иметь несколько типов удостоверений
   - Один тип удостоверения может быть у нескольких сотрудников
   - Дополнительные данные: дата выдачи, номер, статус, файл

3. CERTIFICATES ──(1:1)──> CERTIFICATE_ORDERS
   Каждый тип сертификата имеет порядок отображения


═══════════════════════════════════════════════════════════════════
                    КЛЮЧЕВЫЕ ОСОБЕННОСТИ
═══════════════════════════════════════════════════════════════════

• Файлы хранятся в файловой системе, метаданные - в БД
  - Путь к файлу, оригинальное имя, MIME тип, размер

• Статусы удостоверений (people_certificates.status):
  1 = Активный
  2 = Скоро просрочится
  3 = Просрочен
  4 = Отсутствует (по умолчанию)

• Срок действия сертификата (certificates.expiry_date):
  Хранится как INTEGER (количество дней), не как дата

• Порядок отображения (certificate_orders.sort_order):
  Меньшее значение = выше в списке

• API аутентификация через токены (api_tokens):
  - Токен должен быть активным (is_active = true)
  - Токен не должен быть истекшим (expires_at в будущем или null)


═══════════════════════════════════════════════════════════════════
                        ИНДЕКСЫ
═══════════════════════════════════════════════════════════════════

• people_certificates:
  - UNIQUE(people_id, certificate_id)
  - FK indexes на people_id и certificate_id

• certificate_orders:
  - UNIQUE(certificate_id)
  - INDEX(sort_order)

• sessions:
  - INDEX(user_id)
  - INDEX(last_activity)

• users:
  - UNIQUE(email)

• api_tokens:
  - UNIQUE(token)


